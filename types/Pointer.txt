# New approach: pointer types specified separately from normal types.
# the fields in Struct definitions will look like
# <pointer type name> <field name> referent:<referent group name>
# <type name> <field name>
# <type name>:<expected value to match this Struct definition>

# Dummy zero-length pointer type used for hard-coded addresses.
# The structgroup specifies the address via `bias`.
pointer Address 0
    size

pointer BytePointer 32 values:byte_pointer bias:-0x8000000
    # Indented lines specify filters to apply, including parameters for the
    # View class. (Those parameters do not necessarily match what appears
    # in the disassembly.)
    size

pointer QuadPointer 32 values:quad_pointer bias:-0x8000000
    # The same, but multiple-of-4 alignment is enforced.
    size

# Without `asm` implemented, the referent lookup fails and the chunk
# is simply not extracted (rather than an error being reported).
pointer ArmPointer 32 values:quad_pointer bias:-0x8000000 referent:asm

# Don't treat this as a generic pointer with 2-byte alignment, because
# of the special requirement for the low bit to be set.
pointer ThumbPointer 32 values:thumb_pointer bias:-0x8000001 referent:asm

enum byte_pointer
    0:0x1ffffff
    # The pointer is only treated as valid (and thus followed to find the
    # next chunk) if it isn't given a special name by its `values` enum.
    -0x8000000 NULL

enum thumb_pointer
    0:0x1fffffe:2
    -0x8000001 NULL

enum quad_pointer
    0:0x1fffffc:4
    -0x8000000 NULL

pointer PortraitPointer 32 values:quad_pointer bias:-0x8000000 referent:file:png
    gbalz77
    portrait
    tileimg 16
    png 16

pointer MiniPointer 32 values:quad_pointer bias:-0x8000000 referent:file:png
    gbalz77
    tileimg 4 # 32x32 image = 4x4 tiles
    png 4

pointer MouthPointer 32 values:quad_pointer bias:-0x8000000 referent:file:png
    size 0x600 # 0x30 tiles of 0x20 bytes each.
    tileimg 12 # for now. Not compressed, because it's repeatedly loaded.
    png 12

pointer RawPalettePointer 32 values:quad_pointer bias:-0x8000000 referent:file:png
    size 32 # 32 bytes = 1 palette
    png

pointer MapSpritePointer 32 values:quad_pointer bias:-0x8000000 referent:file:png
    gbalz77
    tileimg 4 # sprites of max width 32?
    png 4

pointer PalettesPointer 32 values:quad_pointer bias:-0x8000000 referent:file:png
    gbalz77 # some number of palettes
    png

pointer LZ77Pointer 32 values:quad_pointer bias:-0x8000000 referent:file
    gbalz77 # data is compressed, but semantics of raw data unknown or unhandled.

pointer BattleBackgroundPointer 32 values:quad_pointer bias:-0x8000000
+   referent:file:png
# a bunch of raw tiles to be arranged by tilemap; we'll show 32 columns.
    gbalz77
    tileimg 32
    png 32

# Compressed Screen Tilemap - 600 tiles worth.
pointer CSTPointer 32 values:quad_pointer bias:-0x8000000 referent:ScreenTiles
    gbalz77
